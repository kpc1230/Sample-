#* @vtlvariable name="action" type="com.atlassian.excalibur.web.ExcaliburSessionAction" *#

<h1 class="dialog-title">$i18n.getText('session.create.title')#if($action.issueKey): $action.htmlEncode($action.issueKey)#end</h1>
<form class="aui" action="$requestContext.baseUrl/secure/CreateSessionPost.jspa?$action.htmlEncode($action.postContext)" method="post">
    <div class="form-body bf-create-form-body">
        <div class="bf-create-session-overlay hidden"></div>
        $action.auiErrorsHTML()
        #if ( (!$action.projectKey || !$action.projectId) && !$action.hasIssueKey())
            <div class="field-group">
                <label for="related-project">$i18n.getText('session.cud.field.related.project')<span class="aui-icon icon-required"></span><span class="content">$i18n.getText('session.cud.field.required')</span></label>
                <select id="related-project" name="relatedProjectKey" class="select" tabindex="1">
                    <option value="">$i18n.getText('session.cud.field.none.option')</option>
                    #foreach ($project in $action.projectList)
                        <option #if($action.relatedProjectKey && $action.relatedProjectKey.equals($project.key.toString())) selected="selected" #end value="$action.htmlEncode($project.key)" data-projectid="$project.id">
                            $action.htmlEncode($project.name)
                        </option>
                    #end
                </select>
                <div class="bf-spinner-container"></div>
            </div>
            <div class="bf-spacer">
            </div>
        #end
        <div class="field-group">
            <label for="ex-session-name">$i18n.getText('session.cud.field.name')<span class="aui-icon icon-required"></span><span class="content">$i18n.getText('session.cud.field.required')</span></label>
            <input type="text" class="text" id="ex-session-name" name="name" value="$action.htmlEncode($action.name)" tabindex="2" maxlength="$action.nameMaxLength">
        </div>
        <div class="field-group">
            <label for="ex-session-shared">$i18n.getText('session.cud.field.shared')</label>
            <input class="checkbox" type="checkbox" id="ex-session-shared" name="shared" tabindex="3" value="true" checked="checked"/>
            <span>$i18n.getText('session.cud.field.shared.info')</span>
        </div>
        <div class="field-group">
            <label for="ex-assignee">$i18n.getText('session.cud.field.assignee')</label>
            <input class="text" id="ex-assignee" name="assignee" data-project-key="$action.htmlEncode($action.projectKey)" value="$action.htmlEncode($action.assignee)" tabindex="4"/>
        </div>
        #if($action.projectKey && $action.projectId)
            #if(!$action.hasIssueKey())
                <div class="field-group jira-no-popup">
                    <label for="ex-issueKey">$i18n.getText('session.cud.field.relatedIssue')</label>
                    <select class="bonfire-issuepicker hidden select" multiple="multiple" name="issueKey" id="ex-issueKey" tabindex="5"
                                data-ajax-options.data.current_jql="project=$action.htmlEncode($action.projectKey)"
                                data-remove-on-un-select="true"
                                data-ajax-options.query="true"
                                data-ajax-options.url="${req.contextPath}/rest/api/1.0/issues/picker"
                                data-ajax-options.data.show-sub-tasks="true"
                                data-ajax-options.data.show-sub-task-parent="true"
                                data-ajax-options.data.current-project-id="$action.projectId">
                        #foreach ($possibleKey in $action.issueKeys)
                            <option selected="selected" value="$action.htmlEncode($possibleKey)">$action.htmlEncode($possibleKey)</option>
                        #end
                    </select>
                </div>
            #end
            <div class="field-group">
                <label for="default-template">$i18n.getText('session.cud.field.default.template')</label>
                <select id="default-template" name="defaultTemplateId" class="select" tabindex="6">
                    <option value="">$i18n.getText('session.cud.field.none.option')</option>
                    #foreach ($template in $action.templateList)
                        <option #if($action.defaultTemplateId && $action.defaultTemplateId.equals($template.id.toString())) selected="selected" #end value="$template.id">$action.htmlEncode($template.name)</option>
                    #end
                </select>
            </div>
        #end
        <div class="field-group">
            <label for="ex-session-info">$i18n.getText('session.cud.field.additional.information')</label>
            <textarea id="ex-session-info" name="additionalInfo" class="field textarea medium" rows="6" tabindex="7">$action.htmlEncode($action.additionalInfo)</textarea>
        </div>
    </div>
    <div class="buttons-container form-footer">
        <div class="buttons">
            <input id="ex-submit" type="submit" class="aui-button aui-button-primary" value="Create" tabindex="10">
            <a href="#close" class="cancel">Close</a>
        </div>
    </div>
    <input type="hidden" name="atl_token" value="${xsrfToken}"/>
</form>
