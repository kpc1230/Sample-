## TODO use aui-format once we drop 4.4 
#set ($session = $action.getSessionUI())
#set ($projectKey = $session.getRelatedProjectKey())
#set ($projectId = $session.getRelatedProjectId())
<html>
<head>
    <content tag="section">bonfire_top_menu_dropdown</content>
    <meta name="decorator" content="general"/>
    <title>$textutils.htmlEncode(${session.getName()})</title>
</head>
<body class="nl">
<header class="aui-page-header">
    <div class="aui-page-header-inner">
        <div class="aui-page-header-main">
            <ol class="aui-nav aui-nav-breadcrumbs">
                <li><a href="$requestContext.baseUrl$textutils.htmlEncode($session.sessionReturnURL)">$textutils.htmlEncode($session.relatedProjectName)</a></li>
            </ol>
            <h1 id="session-name">
                $textutils.htmlEncode($session.name)
                #if($session.shared)
                    <span class="aui-lozenge">$i18n.getText('session.shared')</span>
                #end
            </h1>
        </div>
        <div class="aui-page-header-actions">
            <div class="aui-buttons">
                #if ($action.origin.equals('nav'))
                    <a class="aui-button aui-button-light" href="$requestContext.baseUrl/secure/SessionNavigator.jspa"><span>Back to test sessions</span></a>
                #end
                #if ($session.canCreateSession)
                    <a class="aui-button aui-button-light bf-create-session no-refresh" href="$requestContext.baseUrl/secure/CreateSession.jspa?projectKey=${projectKey}&projectId=${projectId}">
                        <span class="aui-icon aui-icon-small aui-iconfont-add">Add</span>
                        $i18n.getText('project.tab.create.session')
                    </a>
                #end
            </div>
        </div>
    </div>
</header>
<section class="aui-page-panel session-page-wrapper">
    <div class="aui-page-panel-inner">
        <section class="aui-page-panel-content">
            <input id="bonfire-session-id" type="hidden" value="$session.id"/>
            <input id="bonfire-session-status" type="hidden" value="$session.status"/>

            ##
            ## Active area
            ##
            <div id="bonfire-session-main" class="active-area">
                ##
                ## Bonfire Ops Bar
                ##
                #parse("templates/bonfire/web/testsessions/modules/session-view-opsbar.vm")
                ##
                ## Session Details
                ##
                <div class="aui-group">
                    ##
                    ## Left Column
                    ##
                    <div class="aui-item">
                        #if ( !$session.hasAdditionalInfo() || $session.isSessionEditable() )
                            #parse("templates/bonfire/web/testsessions/modules/session-view-additionalinfo.vm")
                        #end
                        #parse("templates/bonfire/web/testsessions/modules/session-view-streams.vm")
                    </div>
                    ##
                    ## Right Column
                    ##
                    <div class="aui-item session-right-column">
                        #if($session.showParticipants)
                                #parse("templates/bonfire/web/testsessions/modules/session-view-participants.vm")
                        #end
                        #if ( ${session.getRelatedIssues().size()}  > 0)
                            #parse("templates/bonfire/web/testsessions/modules/session-view-relatedissue.vm")
                        #end
                        #if ( ${session.getIssuesRaised().size()} >  0 || ${session.getSubTasksRaised().size()} > 0)
                            #parse("templates/bonfire/web/testsessions/modules/session-view-issuesraised.vm")
                        #end
                        #if (!$session.isStatusEditable() && !$session.getSessionStatusChange())
                            #parse("templates/bonfire/web/testsessions/modules/session-view-completedsummary.vm")
                        #end
                    </div>
                </div>
            </div>
            #if($action.feedbackEnabled)
            ##
            ## Feedback
            ##
                <div id="session-links">
                    <a id="bonfire-feedback" href="#">$i18n.getText('bonfire.got.feedback')</a>
                </div>
            #end
            ##
            ## Inline things that shouldn't be
            ##
            #if ($session.showInvite)
                <div style="display:none;">
                    #parse("templates/bonfire/invite/invite-popup.vm")
                </div>
            #end
        </section>
    </div>
</section>
</body>
</html>
